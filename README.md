# 网络配置工具 (Auto update Mac address) 使用文档

## 概述

网络配置工具是一个用于更新控制柜MAC地址的可视化GUI工具。该工具通过友好的图形界面，帮助用户快速配置本地网络适配器并更新控制柜的MAC地址，简化了网络配置的复杂操作流程。

本工具支持自动计算网络配置参数、可视化选择网络适配器、通过SSH远程更新控制柜MAC地址等功能，通过分步骤的引导式界面，降低了网络配置的技术门槛，提高了操作效率。

---

## 系统要求

- **操作系统**：Windows 10/11
- **Python版本**：Python 3.7 或更高版本
- **权限要求**：需要管理员权限（程序会自动请求）
- **依赖库**：
  - tkinter（Python标准库）
  - paramiko（可选，用于SSH连接，如果未安装则使用系统SSH客户端）
  - ipaddress（Python标准库）
  - subprocess（Python标准库）

---

## 打包说明

程序开发完毕后，可以使用 PyInstaller 进行打包，生成独立的可执行文件。

**打包命令示例：**
```bash
pyinstaller --onefile --windowed --name "Auto update Mac address" network_config_gui.py
```

**打包后的文件：**
- 可执行文件位于 `dist/` 目录
- 构建文件位于 `build/` 目录

---

## 功能列表

工具提供以下核心功能：

1. **网络适配器管理** - 自动获取并显示所有网络适配器，支持可视化选择
2. **控制柜信息配置** - 输入控制柜IP地址和SSH密码
3. **自动计算网络参数** - 根据控制柜IP自动计算本地IP、子网掩码、MAC地址
4. **本地网络配置** - 自动配置本地网络适配器的静态IP地址
5. **远程MAC地址更新** - 通过SSH连接控制柜，更新其网络接口MAC地址
6. **实时状态监控** - 显示详细的执行日志和状态信息
7. **错误诊断** - 提供详细的错误信息和故障排除建议

---

## 功能详细说明

### 1. 网络适配器管理

自动获取系统中所有可用的网络适配器，并以可视化列表形式展示，方便用户选择。

**功能特性：**
- 自动获取所有网络适配器（通过PowerShell或netsh）
- 显示适配器名称、连接状态、接口描述
- 支持Unicode字符（中文、日文、韩文等）
- 点击选择适配器，选中项高亮显示
- 支持刷新适配器列表
- 可滚动列表，支持鼠标滚轮操作

**界面位置：**
- 左侧区域：步骤 1 - 选择网络适配器
- 适配器列表：显示所有可用适配器
- 状态显示：已连接（绿色）/ 未连接（灰色）

**使用场景：**
- 选择要配置的网络适配器
- 查看网络适配器状态
- 刷新适配器列表（新增或移除适配器后）

**注意事项：**
- 需要管理员权限才能获取完整的适配器信息
- 某些虚拟适配器可能无法配置IP地址

---

### 2. 控制柜信息配置

输入控制柜的IP地址和SSH登录密码，用于后续的远程连接和配置。

**功能特性：**
- 控制柜IP地址输入（自动验证格式）
- SSH密码输入（默认密码：root）
- 密码输入框支持隐藏显示（*）
- IP地址格式实时验证
- 支持IPv4地址格式

**界面位置：**
- 左侧区域：步骤 2 - 输入控制柜信息
- IP地址输入框：输入控制柜IP
- 密码输入框：输入SSH密码

**使用场景：**
- 配置控制柜连接信息
- 设置SSH认证凭据

**注意事项：**
- IP地址必须是有效的IPv4格式
- 密码为空时会提示用户输入
- 默认SSH用户名为 root

---

### 3. 自动计算网络参数

根据输入的控制柜IP地址，自动计算本地网络配置参数，包括本地IP、子网掩码和MAC地址。

**功能特性：**
- **本地IP计算**：自动计算与控制柜同子网的本地IP地址
  - 最后一位随机生成（2-255），避免与控制柜IP冲突
  - 确保在同一子网内
- **子网掩码计算**：根据IP地址类型自动计算
  - 10.x.x.x → 255.0.0.0
  - 172.16-31.x.x → 255.255.0.0
  - 192.168.x.x → 255.255.255.0
  - 其他 → 255.255.255.0
- **MAC地址生成**：基于时间戳和随机数生成唯一MAC地址
  - 确保本地管理地址（第二位为偶数）
  - 包含时间信息（月、日、时、分、秒）
  - 格式：XX:XX:XX:XX:XX:XX

**界面位置：**
- 左侧区域：步骤 3 - 网络配置信息
- 显示区域：本地IP地址、子网掩码、MAC地址

**使用场景：**
- 自动生成网络配置参数
- 预览配置信息
- 验证配置正确性

**注意事项：**
- IP地址输入后自动计算，无需手动触发
- 计算结果会实时更新显示
- MAC地址每次生成都不同

---

### 4. 本地网络配置

自动配置本地网络适配器的静态IP地址和子网掩码，使本地计算机能够与控制柜通信。

**功能特性：**
- 使用 netsh 命令配置静态IP
- 自动删除现有IP配置（如果存在）
- 设置IP地址和子网掩码
- 支持配置网关（可选）
- 配置完成后等待网络稳定（3秒）

**配置流程：**
1. 检查并删除现有IP配置
2. 设置新的静态IP地址和子网掩码
3. 验证配置是否成功
4. 等待网络稳定

**使用场景：**
- 配置本地网络适配器以连接控制柜
- 设置静态IP地址确保网络稳定

**注意事项：**
- 需要管理员权限
- 配置IP地址可能会暂时断开网络连接
- 建议在配置前备份网络设置
- 配置失败时会自动重试

---

### 5. 远程MAC地址更新

通过SSH连接控制柜，自动更新其网络接口的MAC地址配置。

**功能特性：**
- **SSH连接方式**：
  - 优先使用 paramiko 库（如果已安装）
  - 备用方案：使用系统SSH客户端（需要sshpass或手动输入密码）
- **MAC地址更新**：
  - 修改 `/etc/network/interfaces` 文件
  - 支持更新现有MAC地址配置
  - 支持添加新的MAC地址配置
  - 自动备份原始配置文件
- **错误处理**：
  - 连接超时检测
  - 密码验证失败提示
  - 文件不存在提示
  - 详细的错误信息和建议

**更新流程：**
1. 生成新的MAC地址
2. 通过SSH连接到控制柜
3. 备份原始配置文件
4. 更新或添加 hwaddress ether 配置
5. 验证配置是否成功

**使用场景：**
- 更新控制柜MAC地址
- 配置网络接口硬件地址

**注意事项：**
- 需要SSH访问权限
- 控制柜必须支持SSH连接
- 建议在更新前确保网络连接正常
- 更新MAC地址后可能需要重启网络服务

---

## 注意事项

1. **管理员权限**：
   - 程序需要管理员权限才能配置网络
   - 启动时会自动请求管理员权限
   - 如果拒绝权限提升，程序将无法正常运行

2. **网络连接**：
   - 配置IP地址时可能会暂时断开网络连接
   - 建议在配置前保存重要工作
   - 确保网线连接正常

3. **控制柜连接**：
   - 确保控制柜已开机并正常运行
   - 确保控制柜支持SSH连接
   - 默认SSH用户名为 root
   - 建议在配置前测试SSH连接

4. **IP地址配置**：
   - 本地IP地址会自动计算，确保与控制柜在同一子网
   - 如果IP地址冲突，程序会尝试其他地址
   - 建议在配置前记录原始IP配置

5. **MAC地址更新**：
   - MAC地址每次生成都不同
   - 更新MAC地址后可能需要重启网络服务
   - 建议在更新前备份控制柜配置文件

6. **SSH连接**：
   - 优先使用 paramiko 库（如果已安装）
   - 如果未安装 paramiko，需要使用系统SSH客户端
   - 使用系统SSH客户端时，建议安装 sshpass 以自动输入密码

7. **错误处理**：
   - 程序会提供详细的错误信息
   - 建议仔细阅读错误提示和故障排除建议
   - 如果问题持续，检查网络连接和控制柜状态

8. **程序打包**：
   - 打包后的可执行文件可以独立运行
   - 不需要安装Python环境
   - 建议使用 PyInstaller 打包

---

## 更新日志

### V1.0.0 (2025-01-XX)
- 初始版本发布
- 实现网络适配器自动获取和可视化选择
- 实现控制柜信息配置（IP地址、SSH密码）
- 实现自动计算网络参数（本地IP、子网掩码、MAC地址）
- 实现本地网络静态IP配置
- 实现通过SSH远程更新控制柜MAC地址
- 实现实时状态监控和日志显示
- 实现错误诊断和故障排除建议
- 支持 paramiko 和系统SSH客户端两种连接方式
- 支持Unicode字符显示（中文、日文、韩文等）
- 支持管理员权限自动请求
- 支持配置过程停止功能
- 优化用户界面和交互体验

---
