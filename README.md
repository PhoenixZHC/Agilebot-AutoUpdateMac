# 控制柜MAC地址更新工具 (Auto update Mac address) 使用文档

## 概述

控制柜MAC地址更新工具是一个用于更新控制柜MAC地址的可视化GUI工具。该工具通过友好的图形界面，帮助用户通过SSH远程更新控制柜的MAC地址，简化了网络配置的复杂操作流程。

本工具支持自动生成MAC地址、通过SSH远程更新控制柜MAC地址等功能，通过分步骤的引导式界面，降低了网络配置的技术门槛，提高了操作效率。

---

## 系统要求

- **操作系统**：Windows 10/11
- **权限要求**：需要管理员权限（程序会自动请求）
- **依赖库**（已打包在exe中，无需单独安装）：
  - tkinter（Python标准库）
  - paramiko（可选，用于SSH连接，如果未安装则使用系统SSH客户端）
  - ipaddress（Python标准库）
  - subprocess（Python标准库）

---

## 快速开始

1. **运行程序**
   - 双击 `Auto update Mac address.exe` 启动程序
   - 程序会自动请求管理员权限

2. **输入控制柜信息**
   - 在"步骤1: 输入控制柜信息"中输入控制柜IP地址
   - 输入SSH密码（默认为 root）
   - **重要提示**：请确保本地IP与控制柜IP在同一网段

3. **查看MAC地址**
   - 输入IP地址后，程序会自动生成MAC地址
   - MAC地址显示在"步骤2: MAC地址信息"中

4. **开始配置**
   - 点击绿色的"开始配置"按钮
   - 程序将通过SSH连接控制柜并更新MAC地址
   - 执行状态和日志会显示在右侧面板

---

## 功能列表

工具提供以下核心功能：

1. **控制柜信息配置** - 输入控制柜IP地址和SSH密码
2. **自动生成MAC地址** - 根据时间戳和随机数生成唯一MAC地址
3. **远程MAC地址更新** - 通过SSH连接控制柜，更新其网络接口MAC地址
4. **实时状态监控** - 显示详细的执行日志和状态信息
5. **错误诊断** - 提供详细的错误信息和故障排除建议

---

## 功能详细说明

### 1. 控制柜信息配置

输入控制柜的IP地址和SSH登录密码，用于后续的远程连接和配置。

**功能特性：**
- 控制柜IP地址输入（自动验证格式）
- SSH密码输入（默认密码：root）
- 密码输入框支持隐藏显示（*）
- IP地址格式实时验证
- 支持IPv4地址格式

**界面位置：**
- 左侧区域：步骤 1 - 输入控制柜信息
- IP地址输入框：输入控制柜IP
- 密码输入框：输入SSH密码
- 重要提示：确保本地IP与控制柜IP在同一网段

**使用场景：**
- 配置控制柜连接信息
- 设置SSH认证凭据

**注意事项：**
- IP地址必须是有效的IPv4格式
- 密码为空时会提示用户输入
- 默认SSH用户名为 root
- **使用前请确保本地IP与控制柜IP在同一网段**

---

### 2. MAC地址生成

根据输入的控制柜IP地址，自动生成唯一的MAC地址。

**功能特性：**
- **MAC地址生成**：基于时间戳和随机数生成唯一MAC地址
  - 确保本地管理地址（第二位为偶数）
  - 包含时间信息（月、日、时、分、秒）
  - 格式：XX:XX:XX:XX:XX:XX

**界面位置：**
- 左侧区域：步骤 2 - MAC地址信息
- 显示区域：MAC地址

**使用场景：**
- 自动生成MAC地址
- 预览MAC地址信息

**注意事项：**
- IP地址输入后自动生成，无需手动触发
- MAC地址会实时更新显示
- MAC地址每次生成都不同

---

### 3. 远程MAC地址更新

通过SSH连接控制柜，自动更新其网络接口的MAC地址配置。

**功能特性：**
- **SSH连接方式**：
  - 优先使用 paramiko 库（如果已安装）
  - 备用方案：使用系统SSH客户端（需要sshpass或手动输入密码）
- **MAC地址更新**：
  - 修改 `/etc/network/interfaces` 文件
  - 支持更新现有MAC地址配置
  - 支持添加新的MAC地址配置
  - 自动备份原始配置文件
- **错误处理**：
  - 连接超时检测
  - 密码验证失败提示
  - 文件不存在提示
  - 详细的错误信息和建议

**更新流程：**
1. 生成新的MAC地址
2. 通过SSH连接到控制柜
3. 备份原始配置文件
4. 更新或添加 hwaddress ether 配置
5. 验证配置是否成功

**使用场景：**
- 更新控制柜MAC地址
- 配置网络接口硬件地址

**注意事项：**
- 需要SSH访问权限
- 控制柜必须支持SSH连接
- **使用前请确保本地IP与控制柜IP在同一网段**
- 建议在更新前确保网络连接正常
- 更新MAC地址后可能需要重启网络服务

---

## 界面说明

### 主界面布局

程序采用左右分栏布局：

**左侧面板：**
- **标题区域**：显示"Auto update Mac address"和"自动更新Mac地址"
- **重要提示框**：橙色背景，提醒用户确保本地IP与控制柜IP在同一网段
- **步骤1**：输入控制柜信息（IP地址和密码）
- **步骤2**：显示生成的MAC地址
- **操作按钮**：绿色的"开始配置"按钮

**右侧面板：**
- **执行状态**：深色背景的日志显示区域
- 实时显示执行过程和结果
- 支持滚动查看历史日志

---

## 注意事项

1. **管理员权限**：
   - 程序需要管理员权限才能正常运行
   - 启动时会自动请求管理员权限
   - 如果拒绝权限提升，程序将无法正常运行

2. **网络连接**：
   - **重要**：使用前请确保本地IP与控制柜IP在同一网段
   - 确保网线连接正常
   - 确保控制柜已开机并正常运行

3. **控制柜连接**：
   - 确保控制柜已开机并正常运行
   - 确保控制柜支持SSH连接
   - 默认SSH用户名为 root
   - 建议在配置前测试SSH连接（使用ping或SSH客户端）

4. **MAC地址更新**：
   - MAC地址每次生成都不同
   - 更新MAC地址后可能需要重启网络服务
   - 建议在更新前备份控制柜配置文件

5. **SSH连接**：
   - 优先使用 paramiko 库（如果已安装）
   - 如果未安装 paramiko，需要使用系统SSH客户端
   - 使用系统SSH客户端时，建议安装 sshpass 以自动输入密码

6. **错误处理**：
   - 程序会提供详细的错误信息
   - 建议仔细阅读错误提示和故障排除建议
   - 如果问题持续，检查网络连接和控制柜状态
   - 常见错误：
     - 连接超时：检查网络连接和IP地址
     - 密码验证失败：检查SSH密码是否正确
     - 文件不存在：检查控制柜系统配置

---

## 故障排除

### 连接失败

**问题**：无法连接到控制柜

**解决方案**：
1. 检查控制柜是否已开机
2. 检查网线是否连接正常
3. 检查IP地址是否正确
4. **确保本地IP与控制柜IP在同一网段**
5. 使用ping命令测试网络连通性：`ping <控制柜IP>`
6. 使用SSH客户端测试连接：`ssh root@<控制柜IP>`

### 密码验证失败

**问题**：SSH密码验证失败

**解决方案**：
1. 确认密码是否正确（默认密码：root）
2. 检查SSH服务是否正常运行
3. 确认用户名是否正确（默认：root）

### MAC地址更新失败

**问题**：MAC地址更新失败

**解决方案**：
1. 检查SSH连接是否正常
2. 检查控制柜系统权限
3. 检查 `/etc/network/interfaces` 文件是否存在
4. 查看右侧日志区域的详细错误信息

---

## 更新日志

### V2.0.0 (当前版本)
- 简化功能，专注于MAC地址更新
- 移除网络适配器选择功能
- 移除本地IP自动配置功能
- 添加重要提示：确保本地IP与控制柜IP在同一网段
- 优化界面设计，采用现代化风格
- 移除停止按钮，简化操作流程
- 开始配置按钮改为绿色主题

### V1.0.0
- 初始版本发布
- 实现网络适配器自动获取和可视化选择
- 实现控制柜信息配置（IP地址、SSH密码）
- 实现自动计算网络参数（本地IP、子网掩码、MAC地址）
- 实现本地网络静态IP配置
- 实现通过SSH远程更新控制柜MAC地址
- 实现实时状态监控和日志显示
- 实现错误诊断和故障排除建议
- 支持 paramiko 和系统SSH客户端两种连接方式
- 支持Unicode字符显示（中文、日文、韩文等）
- 支持管理员权限自动请求
- 支持配置过程停止功能
- 优化用户界面和交互体验

---

## 技术支持

如有问题或建议，请查看程序日志或联系技术支持。

---

## 许可证

本工具仅供内部使用。
